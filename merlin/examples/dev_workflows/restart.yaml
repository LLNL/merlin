description:
  name: restart
  description: A simple ensemble for testing step restarts.

batch:
  type: local

env:
  variables:
    OUTPUT_PATH: ./studies
    N_SAMPLES: 10

study:
- name: restart_and_sample_step
  description: runs 
  run:
    cmd: |
      echo "sample: $(V1)"
      exit $(MERLIN_RESTART)
    max_retries: 3

- name: indiv_followup_step
  description: step that can start immedeatly after a sample has finished
  run:
      cmd: echo "followup complete :)"
      depends: [restart_and_sample_step]


- name: bottleneck_step
  description: step that can only start upon complete of all samples in previous step
  run:
      cmd: echo "bottleneck complete :)"
      depends: [restart_and_sample_step_*]

merlin:
  resources:
    task_server: celery
    workers:
      simworkers:
        args: -l INFO --concurrency 1 --prefetch-multiplier 1 -Ofair
        steps: [runs, data]
  samples:
    column_labels: [V1]
    file: $(MERLIN_INFO)/samples.npy
    generate:
      cmd: spellbook make-samples -dims 1 -n $(N_SAMPLES) -outfile=$(MERLIN_INFO)/samples.npy 
